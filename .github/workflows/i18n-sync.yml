name: 🌎i18n Sync and Homologation

on:
  workflow_dispatch:
  pull_request:
    paths:
      - 'i18n/*.json'
      - 'scripts/i18n_sync.py'

jobs:
  i18n-sync:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Run i18n sync (Python)
        run: python scripts/i18n_sync.py

      - name: i18n Sync Summary (Dynamic)
        run: |
          echo "## 🌎 i18n Sync & Homologation Summary" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          if [ -f i18n_sync_report.txt ]; then
            echo "**Status:** ✅ Sync completed. See per-file changes below." >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "### File Change Report" >> $GITHUB_STEP_SUMMARY
            cat i18n_sync_report.txt >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
          else
            echo "**Status:** ⚠️ Sync completed, but no detailed report was found." >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
          fi
          echo "### Ready for Release" >> $GITHUB_STEP_SUMMARY
          echo "- ✔️ No duplicate keys in any file" >> $GITHUB_STEP_SUMMARY
          echo "- ✔️ No unwanted blocks (\`prayer\`, \`test\`) remain" >> $GITHUB_STEP_SUMMARY
          echo "- ✔️ All JSON files are valid and build-ready" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### Next Steps" >> $GITHUB_STEP_SUMMARY
          echo "- If you update translations or add new keys, rerun this workflow before building APK/AAB" >> $GITHUB_STEP_SUMMARY
          echo "- Review translated content for context or style improvements as needed" >> $GITHUB_STEP_SUMMARY
